# 엘라스틱 서치 기본개념
```
엘라스틱 서치의 핵심 기본개념을 읽고 이해한 내용대로 정리해본다.
```
### 시스템 구조
1. 클러스터(cluster)  
엘라스틱 서치의 가장 큰 시스템 단위인 클러스터는 여러 개의 노드로 이루어져 있으며, 모든 노드를 포괄하는 통합 색인화 및 검색 기능을 제공한다.  
클러스터는 고유한 이름으로 식별되는데(기본 값은 elasticsearch) 서로 다르게 구분된 클러스터는 데이터의 접근이나 교환을 할 수 없는 독립적인 시스템으로 유지 된다.  
**config/elasticsearch.yml파일에서 cluster.name을 변경해주면 된다.** 네트워크 바인딩으로 여러 대의 서버에서 하나의 클러스터를 구성할 수 있으며, 반대로 하나의 물리적인 서버에 여러 개의 클러스터가 존재할 수도 있다.

2. 노드(Node)  
노드는 클러스터에 포함된 단일 서버로 데이터를 저장하고 클러스터의 색인화 및 검색 기능에 참여한다. 노드는 각 하나의 엘라스틱서치 프로세스로써 실행된다.   
서로 다른 두개의 노드를 같은 클러스터의 이름으로 설정하였다면 두개의 노드는 하나의 클러스터로 바인딩되어 묶이게 된다. 이렇게 엘라스틱 서치는 간단하게 시스템의 확장을 할 수 있다.  
*하나의 물리적 서버에서 여러 개의 노드가 실행될 때 노드 사이의 바인딩을 위한 통신 포트는 9300부터 차례대로 생성되고, REST API를 위한 http통신 포트는 9200부터 차례대로 생성된다.*
서로 다른 클러스터인 경우에도 한 서버에서 실행되고 있으면 기존 노드와 충돌되지 않게 포트가 차례대로 생성된다. 하지만 서로 다른 클러스터이기 때문에 데이터의 교환은 일어나지 않는다.  
엘라스틱 서치에는 두 종류의 노드가 있다.
   - 마스터 노드 : 전체 클러스터의 상태에 대한 메타 정보를 관리하는 노드이다. **config/elasticsearch.yml파일에서 node.master 속성을 true**로 설정하면 마스터 노드로 선출될 수 있다.
   - 데이터 노드 : 색인된 데이터를 실제로 저장하는 노드이다. **node.data 속성을 false**로 설정하면 해당 노드는 데이터를 저장하지 않는다.  
엘라스틱서치 시스템을 구성할 때 보통 **마스터 노드**는 명령 수행을 전담하는 창구 기능을 하며 **데이터 노드**는 http 통신 기능을 막아 놓아 REST API 접근을 차단하고 데이터를 저장하는 역할만을 전담하도록 설정하는 것이 일반적이다.

3. 인덱스(Index)  
인덱스는 다큐먼트의 모음이며 이름으로 식별된다.(모두 소문자)  
ex) 고객 데이터에 대한 인덱스, 제품 카달로그에 대한 인덱스, 주문 데이터에 대한 인덱스

4. 타입(Type)  
하나의 인덱스에 하나 이상의 타입을 정의할 수 있다. 인덱스를 논리적으로 분류한 것이며 사용자가 직접 결정한다. (일반적으로 공통된 필드(RDBMS에서 컬럼)를 갖는 갖는 문서에 타입이 정의된다.)

5. 도큐먼트(Document)  
도큐먼트는 인덱싱할 수 있는 기본 정보 단위이다. 도큐먼트는 JSON 형식으로 저장되며, 반드시 인덱싱되어 있는 인덱스에 포함된 어떠한 타입으로 지정되어 있어야 한다.

6. 샤드(Shard)와 리플리카(Replica)  
엘라스틱서치는 인덱스(색인)에 방대한 양의 데이터를 저장할 수 있는데 이 데이터가 단일 노드에서 처리될 시 성능이 좋지 못할 수 있다. 엘라스틱서치는 이러한 문제를 해결하고자 아파치 루씬에서 사용되는 메커니즘인 *샤드라는 개념으로 인덱스를 조각으로 분할 하는 기능을 제공한다.*  
이때 최초 샤드에 데이터가 색인되고 나면 다시 동일한 최초 샤드 수만큼 리플리카(복사본)샤드가 다른 노드에 생성한다. 네트워크/클라우드 환경에서 노드가 오프라인상태가 되거나 사라지는 등의 페일오버 매커니즘을 마련하는 것이다.
   - 리플리카 샤드는 데이터 손실(Fail over) 방지와 병렬검색을 통한 성능향상의 장점을 갖는다.  
   - 기본적으로 엘라스틱서치의 각 색인은 기본 샤드 5개 리플리카 1개를 갖는다. 따라서 2개 이상의 노드를 생성하는 것이 좋다. (10개의 샤드가 분산 배치 된다.)  

   사용자는 인덱스 단위로 데이터를 처리하고 엘라스틱서치가 직접 노드로 분산시키는 샤딩을 한다. (샤드와 복사본 개수를 사용자가 설정할 수 있고 그 외에 직접 샤드에 접근하는 경우는 없다.)
